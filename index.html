<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>文字碰撞 + 视频互动</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
</head>
<body style="margin:0; padding:0; overflow:hidden; background:#F9A800;">
  <script>

let words = [];
let input;
let submitButton;
let video;
let fontList = ['sans-serif', 'serif', 'monospace'];
let emojis = ['✨', '🔥', '🌈', '💥', '🍀', '🐱', '🌸', '🎈', '✂️', '🖌️', '🖍️', '🎨', '🧵', '🧶', '📐', '📏', '📌', '📎'];

function setup() {
  createCanvas(windowWidth, windowWidth); // 方形画布
  background('#F9A800');

  // 创建输入框
  input = createInput();
  input.position(20, 20);
  input.size(700);
  input.attribute('placeholder', 'TYPE IN YOUR REF-AI-CTION');
  input.style('font-size', '20px');

  // 创建提交按钮
  submitButton = createButton('DROP');
  submitButton.position(input.x + input.width + 10, 20);
  submitButton.size(70, 40);
  submitButton.mousePressed(addWordFromInput);

  // 创建视频
  video = createVideo(['Myvideo.mp4'], () => {
    video.loop();
    video.volume(0);
  });
  video.show();
  video.play();
}
function mousePressed() {
      if (video) video.play(); // 用户交互保障播放
    }

    function addWordFromInput() {
      let str = input.value().trim();
      if (str.length > 0) {
        let parts = str.match(/\S+/g);
        for (let p of parts) {
          addWord(p);
        }
        input.value('');
      }
    }
function addWordFromInput() {
  let str = input.value().trim();
  if (str.length > 0) {
    let parts = str.match(/\S+/g); // 分词
    for (let p of parts) {
      addWord(p);
    }
    input.value('');
  }
}

function addWord(txt) {
  words.push({
    txt,
    x: random(width),
    y: -20,
    vx: random(-1, 1),
    vy: 0,
    size: random(20, 50),
    font: random(fontList),
    angle: random(TWO_PI),
    rotationSpeed: random(-0.02, 0.02)
  });
}

function draw() {
  background('#F9A800');

  // 视频跟随设备轻微晃动
  let dx = rotationY * 0.2 || 0;
  let dy = rotationX * 0.2 || 0;
  image(video, width / 4 + dx, height / 4 + dy, width / 2, width / 2);

  // 添加随机 emoji
  if (random() < 0.01) {
    addWord(random(emojis));
  }

  // 添加预设文字
  if (frameCount % 60 === 0) {
    addWord(random(['AI', 'WORD', 'ART', '互动', '表达', '自由', '探索', '感受', 'REGULATION', 'WHERE', '拼接者', '偷盗','THEFT' ]));
  }

  // 文字行为
  for (let w of words) {
    w.vy += 0.2; // gravity
    w.x += w.vx;
    w.y += w.vy;

    // 边界碰撞
    if (w.x < 0 || w.x > width) w.vx *= -1;
    if (w.y > height - 20) {
      w.y = height - 20;
      w.vy *= -0.5;
      w.vx *= 0.8;
    }

    // 与视频碰撞
    let videoX = width / 4;
    let videoY = height / 4;
    let videoW = width / 2;
    let videoH = width / 2;
    if (w.x > videoX && w.x < videoX + videoW &&
        w.y > videoY && w.y < videoY + videoH) {
      w.vy *= -0.5;
      w.vx += random(-1, 1);
      w.y = videoY;
    }

    // 旋转绘制
    push();
    translate(w.x, w.y);
    rotate(w.angle);
    fill(0);
    textSize(w.size);
    textFont(w.font);
    textAlign(CENTER, CENTER);
    text(w.txt, 0, 0);
    pop();

    w.angle += w.rotationSpeed;
  }

  // 如果堆满了，全部清空
  if (words.length > 300) {
    words = [];
  }
}

  </script>
</body>
</html>
